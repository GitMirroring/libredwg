{"version":1,"ops":[{"type":6,"author":{"id":"382b9e8c398178f9ea0a60f00ae88550626e36d5"},"timestamp":1572872092,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMzIzMzMwMA=="},"target":"b2441b32d3c6aaab3366b957016b20a442a1a9350cc5ea96dffc8c8b89350a45","message":"Hi,\n\nI'm trying to run the dwglayers.exe app with some DWG files.\nIt works just fine when called via BAT command but when called from a .NET app using Process class it works sometimes and fails to get information from some dwg files.\n\n```\nProcessStartInfo objStartInfo = new ProcessStartInfo();\n            objStartInfo.FileName = \"dwglayers.exe\";\n            objStartInfo.Arguments = string.Format(\"\\\"{0}\\\"\", \"MyDwgFile.dwg\");\n            objStartInfo.RedirectStandardOutput = true;\n            objStartInfo.UseShellExecute = false;\n            objStartInfo.CreateNoWindow = true;\n\n            try\n            {\n                List\u003cstring\u003e lstResult = new List\u003cstring\u003e();\n                using (var objProcess = new Process())\n                {\n                    objProcess.EnableRaisingEvents = true;\n                    objProcess.StartInfo = objStartInfo;\n                    objProcess.OutputDataReceived += (sender, e) =\u003e\n                    {\n                        if (string.IsNullOrWhiteSpace(e.Data))\n                            return;\n\n                        if (e.Data.Trim() == \"0\")\n                            return;\n\n                        if (!lstResult.Any(sItem =\u003e sItem.Equals(e.Data, StringComparison.InvariantCultureIgnoreCase)))\n                            lstResult.Add(e.Data);\n                    };\n\n                    objProcess.Start();\n                    objProcess.BeginOutputReadLine();\n\n                    objProcess.WaitForExit();\n                }\n            }\n            catch (Exception excError)\n            {\n            }\n```\n\n\nIt seems dwglayers.exe doesn't fill the output before exiting (or maybe doesn't flush the output properly).\n\nThe odd behavior is that for some drawings this code works just fine.\nI'm attaching a DWG that can be successfully run via BAT but can't with this code.\n\nIt should list the following layers:\n0\nAFUWS-P\nAFUWS-P-TN\n\nThank you.\n[MyDwgFile.dwg.zip](https://github.com/LibreDWG/libredwg/files/3804033/MyDwgFile.dwg.zip)","files":null},{"type":6,"author":{"id":"382b9e8c398178f9ea0a60f00ae88550626e36d5"},"timestamp":1572872124,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMzIzMzQ4Mg=="},"target":"b2441b32d3c6aaab3366b957016b20a442a1a9350cc5ea96dffc8c8b89350a45","message":"Hi,\n\nI'm trying to run the dwglayers.exe app with some DWG files.\nIt works just fine when called via BAT command but when called from a .NET app using Process class it works sometimes and fails to get information from some dwg files.\n\n```\n            ProcessStartInfo objStartInfo = new ProcessStartInfo();\n            objStartInfo.FileName = \"dwglayers.exe\";\n            objStartInfo.Arguments = string.Format(\"\\\"{0}\\\"\", \"MyDwgFile.dwg\");\n            objStartInfo.RedirectStandardOutput = true;\n            objStartInfo.UseShellExecute = false;\n            objStartInfo.CreateNoWindow = true;\n\n            try\n            {\n                List\u003cstring\u003e lstResult = new List\u003cstring\u003e();\n                using (var objProcess = new Process())\n                {\n                    objProcess.EnableRaisingEvents = true;\n                    objProcess.StartInfo = objStartInfo;\n                    objProcess.OutputDataReceived += (sender, e) =\u003e\n                    {\n                        if (string.IsNullOrWhiteSpace(e.Data))\n                            return;\n\n                        if (e.Data.Trim() == \"0\")\n                            return;\n\n                        if (!lstResult.Any(sItem =\u003e sItem.Equals(e.Data, StringComparison.InvariantCultureIgnoreCase)))\n                            lstResult.Add(e.Data);\n                    };\n\n                    objProcess.Start();\n                    objProcess.BeginOutputReadLine();\n\n                    objProcess.WaitForExit();\n                }\n            }\n            catch (Exception excError)\n            {\n            }\n```\n\n\nIt seems dwglayers.exe doesn't fill the output before exiting (or maybe doesn't flush the output properly).\n\nThe odd behavior is that for some drawings this code works just fine.\nI'm attaching a DWG that can be successfully run via BAT but can't with this code.\n\nIt should list the following layers:\n0\nAFUWS-P\nAFUWS-P-TN\n\nThank you.\n[MyDwgFile.dwg.zip](https://github.com/LibreDWG/libredwg/files/3804033/MyDwgFile.dwg.zip)","files":null},{"type":3,"author":{"id":"382b9e8c398178f9ea0a60f00ae88550626e36d5"},"timestamp":1572876926,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0OTM3MTg4OQ==","github-url":"https://github.com/LibreDWG/libredwg/issues/166#issuecomment-549371889"},"message":"Maybe there is an exception happening at line 172:\n`dwg_free (\u0026dwg);`\n\nFor this specific DWG and it is not finishing the stdout.\nMaybe a call to:\n`fflush(stdout);`\n\nafter finishing the FOR loop to assure the buffer will be flush at that time.\n\nAny thoughts?","files":null},{"type":6,"author":{"id":"382b9e8c398178f9ea0a60f00ae88550626e36d5"},"timestamp":1572876926,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMzI3OTYxOA=="},"target":"05881778162e62a70438f76d449ca58b68c99e6e6bacb96ec8443b160654af67","message":"I was checking the dwglayers code and maybe there is an exception happening at line 172:\n`dwg_free (\u0026dwg);`\n\nMaybe, because of that, this specific DWG is not finishing the stdout.\nWhat about adding, at line 162 (right after the FOR loop):\n`fflush(stdout);`\n\nThis will assure the buffer will be flush at that time regardless what happens after this point.\n\nAny thoughts?","files":null},{"type":5,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572879727,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI3NjgwMjIxMTA="},"added":["blocking"],"removed":[]},{"type":5,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572879727,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI3NjgwMjIxMTI="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572941918,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0OTcxMjA1NQ==","github-url":"https://github.com/LibreDWG/libredwg/issues/166#issuecomment-549712055"},"message":"The exception happened no in dwg_free, but earlier, in the loop already. \nThere may be NULL layer_control.entries.\nBut a flush makes sense after every line, as the loop is too fragile.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572941918,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMzc2MjMyMw=="},"target":"0c700cf051d1f7df1749b9d751bf602fdcda5ac1d1bd6c018a84679e5921b98d","message":"The exception happened no in dwg_free, but earlier, in the loop already. \nThere may be NULL layer_control.entries.\nBut a flush makes sense after every line, as the loop is too fragile.\n\nI think that requires now a patch release 0.9.2.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572941940,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwMzc2MjUwMA=="},"target":"0c700cf051d1f7df1749b9d751bf602fdcda5ac1d1bd6c018a84679e5921b98d","message":"The exception happened no in dwg_free, but earlier, in the loop already. \nThere may be NULL layer_control.entries.\nBut a flush makes sense after every line, as the loop is too fragile.\n\nI think that requires now another patch release 0.9.2.","files":null},{"type":4,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1572946431,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mjc3MDY4MzMwMQ=="},"status":2},{"type":3,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573025052,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0OTkxMTQ5MA==","github-url":"https://github.com/LibreDWG/libredwg/issues/167#issuecomment-549911490"},"message":"Interesting, I'll check.\nbit_convert_TU just converts UTF-2 to utf-8 display or DXF, but doesn't mangle any space characters.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573025052,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwNDQ1OTIyNg=="},"target":"b166b083f7d49cb2e3b4bc6a95fa5c63df4a111ab1169824dffe421d089e9ca4","message":"Interesting, I'll check.\nbit_convert_TU just converts UTF-2 to utf-8 for display or DXF, but doesn't mangle any space characters.","files":null},{"type":3,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573026146,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU1MDE4NDgwMw==","github-url":"https://github.com/LibreDWG/libredwg/issues/167#issuecomment-550184803"},"message":"The DWG format stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps, which cannot handle space in table names.\nThe conversion of those names is stored in a XRECORD with EXTNAMES.\nIn our case:\n```\nXRECORD\nhandle: 0.1.EA [H 5]\nxdata[0]: \"EXTNAMES\" [TF 8 102]\nxdata[1]: \"ARM_CAPS\" [TF 8 1]\nxdata[2]: \"ARM CAPS\" [TF 8 2]\n...\n```\nwhich is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\nso dwglayer could be extended (by some new flag) to display the layers EXTNAMES, with the space instead of the underscore.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573026146,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwNDQ2NzE4NA=="},"target":"05965d080255e171a97ab113ad99c3349e0bc3572b0dd0b1029aba10b91ec309","message":"The DWG format stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps and acad 14, which cannot handle space in table names. see the systemvariable EXTNAMES.\n\nThe conversion of those names is stored in a XRECORD with EXTNAMES.\nIn our case:\n```\nXRECORD\nhandle: 0.1.EA [H 5]\nxdata[0]: \"EXTNAMES\" [TF 8 102]\nxdata[1]: \"ARM_CAPS\" [TF 8 1]\nxdata[2]: \"ARM CAPS\" [TF 8 2]\n...\n```\nwhich is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\nso dwglayer could be extended (by some new flag) to display the layers EXTNAMES, with the space instead of the underscore.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573120984,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwNTI2MDA1NQ=="},"target":"05965d080255e171a97ab113ad99c3349e0bc3572b0dd0b1029aba10b91ec309","message":"The DWG format for r13 and r14 stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps and acad 14, which cannot handle space in table names. (resp. seperated layer lists by spaces in certain lisp apps)\nNewer DWG versions always store the extended name, with spaces.\nSee also the systemvariable EXTNAMES.\n\nThe conversion of those names is stored in a XRECORD with EXTNAMES.\nIn our case:\n```\nXRECORD\nhandle: 0.1.EA [H 5]\nxdata[0]: \"EXTNAMES\" [TF 8 102]\nxdata[1]: \"ARM_CAPS\" [TF 8 1]\nxdata[2]: \"ARM CAPS\" [TF 8 2]\n...\n```\nwhich is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\nSo dwglayer could be extended (by some new --extnames flag) to display the layers EXTNAMES, with the space instead of the underscore. This is only relevant for r13 and r14 DWGs. With newer DWGs --extnames is ignore, i.e. it always prints the extended names with spaces.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573121265,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwNTI2Mjc1OA=="},"target":"05965d080255e171a97ab113ad99c3349e0bc3572b0dd0b1029aba10b91ec309","message":"The DWG format for r13 and r14 stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps and acad 14, which cannot handle space in table names. (resp. seperated layer lists by spaces in certain lisp apps)\nNewer DWG versions always store the extended name, with spaces.\nSee also the systemvariable EXTNAMES.\n\nThe conversion of those names is stored in a XRECORD with EXTNAMES.\nIn our case:\n```\nXRECORD\nhandle: 0.1.EA [H 5]\nxdata[0]: \"EXTNAMES\" [TF 8 102]\nxdata[1]: \"ARM_CAPS\" [TF 8 1]\nxdata[2]: \"ARM CAPS\" [TF 8 2]\n...\n```\nwhich is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\nSo dwglayer could be extended (by some new --extnames flag) to display the layers EXTNAMES, with the space instead of the underscore. This is only relevant for r13 and r14 DWGs. With newer DWGs --extnames is ignored, i.e. it always prints the extended names with spaces.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573122162,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDMwNTI3MTUxMA=="},"target":"05965d080255e171a97ab113ad99c3349e0bc3572b0dd0b1029aba10b91ec309","message":"The DWG format for r13 and r14 stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps and acad 14, which cannot handle space in table names. (resp. seperated layer lists by spaces in certain lisp apps)\nNewer DWG versions always store the extended name, with spaces.\nSee also the systemvariable EXTNAMES.\n\nThe conversion of those names is stored in a XRECORD with EXTNAMES.\nIn our case:\n```\nXRECORD\nhandle: 0.1.EA [H 5]\nxdata[0]: \"EXTNAMES\" [TF 8 102]\nxdata[1]: \"ARM_CAPS\" [TF 8 1]\nxdata[2]: \"ARM CAPS\" [TF 8 2]\n...\n```\nwhich is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\nSo dwglayer could be extended (by some new --extnames flag) to display the layers EXTNAMES, with the space instead of the underscore. This is only relevant for r13 and r14 DWGs. With newer DWGs `--extnames` is ignored, i.e. it always prints the extended names with spaces.","files":null},{"type":2,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573025819,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjc3NDI0MzU3Ng=="},"title":"Layers EXTNAMES  (spaces vs  _)","was":"Odd buffer output"},{"type":5,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573026007,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDI3NzQyNTA0NjA="},"added":["enhancement"],"removed":[]},{"type":2,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573026210,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjc3NDI1Nzk3OA=="},"title":"dwglayer EXTNAMES  (spaces vs  _)","was":"Layers EXTNAMES  (spaces vs  _)"},{"type":2,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573026243,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50Mjc3NDI1OTA2MA=="},"title":"dwglayers should optionally display EXTNAMES  (spaces vs  _)","was":"dwglayer EXTNAMES  (spaces vs  _)"},{"type":3,"author":{"id":"382b9e8c398178f9ea0a60f00ae88550626e36d5"},"timestamp":1573038520,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU1MDI2MjY4NQ==","github-url":"https://github.com/LibreDWG/libredwg/issues/167#issuecomment-550262685"},"message":"\u003e The DWG format stores the layer name with the underscore, i.e. \"ARM_CAPS\", and the application displays some of those names with a space instead, i.e. \"ARM CAPS\". I guess they do it for backwards compatibility with older 3rdparty apps and acad 14, which cannot handle space in table names. see the systemvariable EXTNAMES.\n\u003e \n\u003e The conversion of those names is stored in a XRECORD with EXTNAMES.\n\u003e In our case:\n\u003e \n\u003e ```\n\u003e XRECORD\n\u003e handle: 0.1.EA [H 5]\n\u003e xdata[0]: \"EXTNAMES\" [TF 8 102]\n\u003e xdata[1]: \"ARM_CAPS\" [TF 8 1]\n\u003e xdata[2]: \"ARM CAPS\" [TF 8 2]\n\u003e ...\n\u003e ```\n\u003e \n\u003e which is owned by a DICTIONARY named ACAD_XREC_ROUNDTRIP, which is owned by the LAYER ARM_CAPS.\n\u003e \n\u003e so dwglayer could be extended (by some new flag) to display the layers EXTNAMES, with the space instead of the underscore.\n\nYes, indeed. `EXTNAMES` was created to support old drawing table name limitations.\nThank you for addressing this and look forward to get the `dwglayers.exe` updated version.","files":null},{"type":4,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1573122918,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mjc3ODgyOTM0Ng=="},"status":2}]}