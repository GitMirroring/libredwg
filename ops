{"version":1,"ops":[{"type":1,"author":{"id":"c6e7d2f14903efaf31af39962996c875d26e8b83"},"timestamp":1581899331,"metadata":{"github-id":"MDU6SXNzdWU1NjU5OTgxOTE=","github-url":"https://github.com/LibreDWG/libredwg/issues/203","origin":"github"},"title":"Make fails on Perl checks, which perl module is needed?","message":"This post is listed in the order of questions first followed by specs, problem descriptions, and information.\n\n### Questions:\n1. What perl module is needed to get past the make check error shown below? \n    (see the \"04 output:\" of the \"Description of the problem:\" section shown below.)\n2. What does the error message about the undefined symbol in line 187 of the DynaLoader.pm file mean and is this significant or can this be ignored for now?\n    (see the \"Make check error examined:\" section near the bottom)\n3. Please let me know if I can provide anything else that might be helpful for figuring this out. Thanks.\n\n### Specs:\n**OS:** Linux\n**Desktop:** Xubuntu 18.04.4 LTS\n**Bash version:** 4.4.20(1)-release (x86_64-pc-linux-gnu)\n**Perl version:** 5.26.1-6ubuntu0.3\n**Dependencies installed:**\n- TeXinfo for building the docs\n- pslib for dwg2ps: http://pslib.sourceforge.net/doc/pslib.html\n- pcre2 with 8bit and 16bit libraries for dwggrep regexp support\n- SWIG 1.7+\n- Python 2.7 or 3.x development headers (debian: python-dev; yum: python-devel)\n  and the libxml2 python bindings.\n- Perl 5 for the perl bindings\n- doxygen to generate the reference manual\n- jq to check json validity\n- valgrind to find leaks and memory bugs\n- timeout to help tests with large or hanging DWG's\n- GNU parallel to speed up special tests\n\n**Dependencies not installed:**\n- picat\n\nThe above package was not installed due to not being available by default in the apt-cache repositories.\n\n### Description of the problem:\n**Steps taken:**\n**01 command:** sh ./autogen.sh\n**01 outcome:** no errors.\n\n**02 command:** ./configure\n**02 outcome:** no errors, config looked ok.\n\n**03 command:** make\n**03 outcome:** Two possible errors listed, both with the same message:\n\n\u003e make regen-dynapi might be needed\n\n***Here is the truncated make output:***\n- Paths and successful make blocks have been truncated for readability.\n- Make message blocks are shown in the order received.\n- Note that \"all-am\" passes the \"make regen-dynapi might be needed\" message, but then completes successfully without this error in a later message block.\n- Note that \"perl\" shows no errors.\n\n```Make\nmake  all-recursive\n...\nmake  all-am\nmake[3]: Entering directory '.../libredwg/src'\necho make regen-dynapi might be needed\nmake regen-dynapi might be needed\n...\nMaking all in doc\nmake[2]: Entering directory '.../libredwg/doc'\necho make regen-dynapi might be needed\nmake regen-dynapi might be needed\n...\nmake  all-am\nmake[4]: Entering directory '.../libredwg/bindings/python'\nmake[4]: Nothing to be done for 'all-am'.\nmake[4]: Leaving directory '.../libredwg/bindings/python'\nmake[3]: Leaving directory '.../libredwg/bindings/python'\nmake[3]: Entering directory '.../libredwg/bindings'\nMaking all for perl\nmake[3]: Leaving directory '.../libredwg/bindings'\nmake[2]: Leaving directory '.../libredwg/bindings'\nmake[2]: Entering directory '.../libredwg'\nmake[2]: Nothing to be done for 'all-am'.\nmake[2]: Leaving directory '.../libredwg'\nmake[1]: Leaving directory '.../libredwg'\n```\n\n**04 command:** make check\n**04 output:** All checks \"PASED\" with the exeption of the following error on Perl:\n```Make\nMaking all for perl\nMaking check for perl\nif grep \"NOOP = rem\" perl/Makefile; then false; else \\\n    LD_LIBRARY_PATH=\"~/Programs/libredwg/src/.libs\" make -C perl test \\\n      OPTIMIZE=\"-I~/Programs/libredwg/include -I~/Programs/libredwg/src\" \\\n              OTHERLDFLAGS=\"-L~/Programs/libredwg/src/.libs\"; fi\nmake[4]: Entering directory '~/Programs/libredwg/bindings/perl'\n\"/usr/bin/perl\" -MExtUtils::Command::MM -e 'cp_nonempty' -- LibreDWG.bs blib/arch/auto/LibreDWG/LibreDWG.bs 644\nPERL_DL_NONLAZY=1 \"/usr/bin/perl\" \"-MExtUtils::Command::MM\" \"-MTest::Harness\" \"-e\" \"undef *Test::Harness::Switches; test_harness(0, 'blib/lib', 'blib/arch')\" t/*.t\nt/0_basic.t .. 1/1 \n#   Failed test 'use LibreDWG;'\n#   at t/0_basic.t line 2.\n#     Tried to use 'LibreDWG'.\n#     Error:  Can't load '~/Programs/libredwg/bindings/perl/blib/arch/auto/LibreDWG/LibreDWG.so' for module LibreDWG: ~/Programs/libredwg/bindings/perl/blib/arch/auto/LibreDWG/LibreDWG.so: undefined symbol: dwg_get_entity_layer at /usr/lib/x86_64-linux-gnu/perl/5.26/DynaLoader.pm line 187.\n#  at ~/Programs/libredwg/bindings/perl/blib/lib/LibreDWG.pm line 11.\n# Compilation failed in require at t/0_basic.t line 2.\n# BEGIN failed--compilation aborted at t/0_basic.t line 2.\n# Looks like you failed 1 test of 1.\nt/0_basic.t .. Dubious, test returned 1 (wstat 256, 0x100)\nFailed 1/1 subtests \n\nTest Summary Report\n-------------------\nt/0_basic.t (Wstat: 256 Tests: 1 Failed: 1)\n  Failed test:  1\n  Non-zero exit status: 1\nFiles=1, Tests=1,  1 wallclock secs ( 0.03 usr  0.00 sys +  0.12 cusr  0.02 csys =  0.17 CPU)\nResult: FAIL\nFailed 1/1 test programs. 1/1 subtests failed.\nMakefile:997: recipe for target 'test_dynamic' failed\nmake[4]: *** [test_dynamic] Error 1\nmake[4]: Leaving directory '~/Programs/libredwg/bindings/perl'\nMakefile:781: recipe for target 'check-am' failed\nmake[3]: [check-am] Error 2 (ignored)\nmake[3]: Leaving directory '~/Programs/libredwg/bindings'\nmake[2]: Leaving directory '~/Programs/libredwg/bindings'\nmake[2]: Entering directory '~/Programs/libredwg'\nmake[2]: Nothing to be done for 'check-am'.\nmake[2]: Leaving directory '~/Programs/libredwg'\nmake[1]: Leaving directory '~/Programs/libredwg'\n```\n\n### Make check error examined:\nThe above error states the following:\n\u003e undefined symbol: dwg_get_entity_layer at /usr/lib/x86_64-linux-gnu/perl/5.26/DynaLoader.pm line 187.\n\nHere is line 187 of DynaLoader.pm:\n```java\n    my $libref = dl_load_file($file, $flags) or croak(\"Can't load '$file' for module $module: \".dl_error());\n```\n\nHere is the block of code that line 187 exists within:\n```java\nsub bootstrap {\n    # use local vars to enable $module.bs script to edit values\n    local(@args) = @_;\n    local($module) = $args[0];\n    local(@dirs, $file);\n\n    unless ($module) {\n\trequire Carp;\n\tCarp::confess(\"Usage: DynaLoader::bootstrap(module)\");\n    }\n\n    # A common error on platforms which don't support dynamic loading.\n    # Since it's fatal and potentially confusing we give a detailed message.\n    croak(\"Can't load module $module, dynamic loading not available in this perl.\\n\".\n\t\"  (You may need to build a new perl executable which either supports\\n\".\n\t\"  dynamic loading or has the $module module statically linked into it.)\\n\")\n\tunless defined(\u0026dl_load_file);\n\n\n    my @modparts = split(/::/,$module);\n    my $modfname = $modparts[-1];\n    my $modfname_orig = $modfname; # For .bs file search\n\n    # Some systems have restrictions on files names for DLL's etc.\n    # mod2fname returns appropriate file base name (typically truncated)\n    # It may also edit @modparts if required.\n    $modfname = \u0026mod2fname(\\@modparts) if defined \u0026mod2fname;\n\n\n    my $modpname = join('/',@modparts);\n\n    print STDERR \"DynaLoader::bootstrap for $module \",\n\t\t       \"(auto/$modpname/$modfname.$dl_dlext)\\n\"\n\tif $dl_debug;\n\n    my $dir;\n    foreach (@INC) {\n\t\n\t$dir = \"$_/auto/$modpname\";\n\n\tnext unless -d $dir; # skip over uninteresting directories\n\n\t# check for common cases to avoid autoload of dl_findfile\n        my $try = \"$dir/$modfname.$dl_dlext\";\n\tlast if $file = ($do_expand) ? dl_expandspec($try) : ((-f $try) \u0026\u0026 $try);\n\n\t# no luck here, save dir for possible later dl_findfile search\n\tpush @dirs, $dir;\n    }\n    # last resort, let dl_findfile have a go in all known locations\n    $file = dl_findfile(map(\"-L$_\",@dirs,@INC), $modfname) unless $file;\n\n    croak(\"Can't locate loadable object for module $module in \\@INC (\\@INC contains: @INC)\")\n\tunless $file;\t# wording similar to error from 'require'\n\n    my $bootname = \"boot_$module\";\n    $bootname =~ s/\\W/_/g;\n    @dl_require_symbols = ($bootname);\n\n    # Execute optional '.bootstrap' perl script for this module.\n    # The .bs file can be used to configure @dl_resolve_using etc to\n    # match the needs of the individual module on this architecture.\n    # N.B. The .bs file does not following the naming convention used\n    # by mod2fname.\n    my $bs = \"$dir/$modfname_orig\";\n    $bs =~ s/(\\.\\w+)?(;\\d*)?$/\\.bs/; # look for .bs 'beside' the library\n    if (-s $bs) { # only read file if it's not empty\n        print STDERR \"BS: $bs ($^O, $dlsrc)\\n\" if $dl_debug;\n        eval { local @INC = ('.'); do $bs; };\n        warn \"$bs: $@\\n\" if $@;\n    }\n\n    my $boot_symbol_ref;\n\n    # Many dynamic extension loading problems will appear to come from\n    # this section of code: XYZ failed at line 123 of DynaLoader.pm.\n    # Often these errors are actually occurring in the initialisation\n    # C code of the extension XS file. Perl reports the error as being\n    # in this perl code simply because this was the last perl code\n    # it executed.\n\n    my $flags = $module-\u003edl_load_flags;\n    \n    my $libref = dl_load_file($file, $flags) or\n\tcroak(\"Can't load '$file' for module $module: \".dl_error());\n\n    push(@dl_librefs,$libref);  # record loaded object\n\n    $boot_symbol_ref = dl_find_symbol($libref, $bootname) or\n         croak(\"Can't find '$bootname' symbol in $file\\n\");\n\n    push(@dl_modules, $module); # record loaded module\n\n  boot:\n    my $xs = dl_install_xsub(\"${module}::bootstrap\", $boot_symbol_ref, $file);\n\n    # See comment block above\n\n\tpush(@dl_shared_objects, $file); # record files loaded\n\n    \u0026$xs(@args);\n}\n```","files":null}]}