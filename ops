{"version":1,"ops":[{"type":1,"author":{"id":"adf43da3a2a0f02dbfb5a8bdfc874e2af71e656d"},"timestamp":1562316654,"metadata":{"github-id":"MDU6SXNzdWU0NjQ1MzQxODY=","github-url":"https://github.com/LibreDWG/libredwg/issues/117","origin":"github"},"title":"Invalid FIELD object decoding","message":"Hi,\n\nThe FIELD object does not decode correctly because:\n1) Data is read into unallocated memory area.\n2) The handles are not read from the handle stream.\n\nThe following changes are needed:\n\n  DECODER { if (_obj-\u003enum_childs) _obj-\u003enum_childs--; }\n  //DEBUG_HERE_OBJ\n  HANDLE_VECTOR (childs, num_childs, 3, 360);\n  FIELD_BL (num_objects, 97);\n  HANDLE_VECTOR (objects, num_objects, 5, 331);\n\nshould change to: (The handles are read later, also the decrement of num_childs is not needed - there are num_childs handles later)\n  //DECODER { if (_obj-\u003enum_childs) _obj-\u003enum_childs--; }\n  //DEBUG_HERE_OBJ\n  //HANDLE_VECTOR (childs, num_childs, 3, 360);\n  FIELD_BL (num_objects, 97);\n  //HANDLE_VECTOR (objects, num_objects, 5, 331);\n\nthen:\n  REPEAT_N((long)FIELD_VALUE(num_childval), childval, Dwg_FIELD_ChildValue)\n\nshould change to: (The memory needs to be allocated for the child values)\n\n  REPEAT(num_childval, childval, Dwg_FIELD_ChildValue)\n\nand finally, add the following field to dwg_object_FIELD structure:\n  BITCODE_H ownerhandle; \n\nand then add the following to the end of the decode spec so that the handles can be read:\n  START_HANDLE_STREAM;\n  FIELD_HANDLE (ownerhandle, 4, 0);\n  REACTORS(4);\n  XDICOBJHANDLE(3);\n  HANDLE_VECTOR (childs, num_childs, 3, 360);\n  HANDLE_VECTOR (objects, num_objects, 5, 331);","files":null}]}