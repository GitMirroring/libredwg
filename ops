{"version":1,"ops":[{"type":1,"author":{"id":"92d786e78a13918866d6b1068d3f0983fe3b982d"},"timestamp":1578021565,"metadata":{"github-id":"MDU6SXNzdWU1NDQ4MzQ0NDM=","github-url":"https://github.com/LibreDWG/libredwg/issues/179","origin":"github"},"title":"Several bugs found by fuzzing","message":"Hi,\nAfter fuzzing libredwg, I found the following bugs on the latest commit on master.\nCommand: ./dwg2svg2 $PoC\n**1.heap-buffer-overflow in read_pages_map ../../src/decode_r2007.c:1007**\nPOC: https://github.com/linhlhq/research/blob/master/PoCs/libreDWG_0.9.3.2564/id:000239%2Csig:06%2Csrc:007083%2Cop:havoc%2Crep:4\nASAN says:\n```\n==4335==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x611000000258 at pc 0x55f9e1e04e05 bp 0x7ffc92f94a40 sp 0x7ffc92f94a30\nREAD of size 8 at 0x611000000258 thread T0\n    #0 0x55f9e1e04e04 in read_pages_map ../../src/decode_r2007.c:1007\n    #1 0x55f9e1e04e04 in read_r2007_meta_data ../../src/decode_r2007.c:1774\n    #2 0x55f9e1dd66d7 in decode_R2007 ../../src/decode.c:2973\n    #3 0x55f9e1dd66d7 in dwg_decode ../../src/decode.c:241\n    #4 0x55f9e177b466 in dwg_read_file ../../src/dwg.c:210\n    #5 0x55f9e1776d4b in test_SVG ../../examples/dwg2svg2.c:116\n    #6 0x55f9e1776d4b in main ../../examples/dwg2svg2.c:501\n    #7 0x7f595f806b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)\n    #8 0x55f9e17779a9 in _start (/home/user/linhlhq/libredwg/asan_build/examples/dwg2svg2+0x2d59a9)\n\n0x61100000025c is located 0 bytes to the right of 220-byte region [0x611000000180,0x61100000025c)\nallocated by thread T0 here:\n    #0 0x7f5960052d38 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded38)\n    #1 0x55f9e1de73be in read_system_page ../../src/decode_r2007.c:635\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow ../../src/decode_r2007.c:1007 in read_pages_map\nShadow bytes around the buggy address:\n  0x0c227fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c227fff8000: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00\n  0x0c227fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c227fff8020: 00 00 00 00 00 00 fa fa fa fa fa fa fa fa fa fa\n  0x0c227fff8030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n=\u003e0x0c227fff8040: 00 00 00 00 00 00 00 00 00 00 00[04]fa fa fa fa\n  0x0c227fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c227fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c227fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c227fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c227fff8090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07\n  Heap left redzone:       fa\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n  Left alloca redzone:     ca\n  Right alloca redzone:    cb\n==4335==ABORTING\n```","files":null}]}