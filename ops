{"version":1,"ops":[{"type":3,"author":{"id":"e8188aeb51b21abdf3894e21cc87842c8f27d0ba"},"timestamp":1542642995,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzOTk0MjYyMg==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-439942622"},"message":"If you want to dive into the problem, I can send you the problem file","files":null},{"type":3,"author":{"id":"e8188aeb51b21abdf3894e21cc87842c8f27d0ba"},"timestamp":1542643117,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQzOTk0MzQxMA==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-439943410"},"message":"Second free is invoked from `common_entity_handle_data.spec` file:\n```\nif (FIELD_VALUE(entity_mode) == 0 || IF_IS_ENCODER)\n  {\n    FIELD_HANDLE(subentity, 4, 0); // doc: owner ref always?\n  }\n```","files":null},{"type":5,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542652320,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDE5NzU0MjU4NDE="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542709858,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MDIyMzUxNg==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-440223516"},"message":"I'm not sure if we can eliminate all double free's, since we have arbitrary refs around which can always point to an already free'd object. But we can ensure to NULL every free'd object, so it will not be freed again.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542709858,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1MzUxNDY4NQ=="},"target":"ec1658b5d968001a975266d70c6b53e78e498bb039a58703339f7119fd3721a7","message":"I'm not sure if we can eliminate all double free's, since we have arbitrary refs around which can always point to an already free'd object. But we can ensure to NULL every free'd object, so it will not be freed again. Resp. for objects mark it with type FREED.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542710245,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1MzUxNzMxNA=="},"target":"ec1658b5d968001a975266d70c6b53e78e498bb039a58703339f7119fd3721a7","message":"I'm not sure if we can eliminate all double free's, since we have arbitrary refs around which can always point to an already free'd object. But we can ensure to NULL every free'd object, so it will not be freed again. Resp. for objects mark it with type FREED.\n\nCan you please send me your DWG? Working on that now","files":null},{"type":3,"author":{"id":"e8188aeb51b21abdf3894e21cc87842c8f27d0ba"},"timestamp":1542714904,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MDI0NzQ2MA==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-440247460"},"message":"[This file](https://github.com/DenisPryt/libredwg/blob/issue_43_dwg_file/test/test-data/double_free_example.dwg)\nYou can catch creation moment in `decode.c` file on line `2910 dwg-\u003eobject_ref[dwg-\u003enum_object_refs++] = ref;` when `dwg-\u003enum_object_refs` equals 191806","files":null},{"type":3,"author":{"id":"e8188aeb51b21abdf3894e21cc87842c8f27d0ba"},"timestamp":1542715933,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MDI1MTEwOA==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-440251108"},"message":"And first `free` is invoked in `free.c` file on line `678 dwg_free_object(\u0026dwg-\u003eobject[i]);` (loop for not control objects).\nobjectIndex is 44637, objectType is 642, objectFixedType is `DWG_TYPE_UNKNOWN_ENT`","files":null},{"type":6,"author":{"id":"e8188aeb51b21abdf3894e21cc87842c8f27d0ba"},"timestamp":1542715933,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1MzU0ODg2MA=="},"target":"b194278f121070e5f2ba7e980734ee65d36689751c890381a3baa06d54a298ba","message":"And first `dwg_free_object` is invoked in `free.c` file on line `678 dwg_free_object(\u0026dwg-\u003eobject[i]);` (loop for not control objects).\nobjectIndex is 44637, objectType is 642, objectFixedType is `DWG_TYPE_UNKNOWN_ENT`","files":null},{"type":3,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542718766,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ0MDI2MjY2Mw==","github-url":"https://github.com/LibreDWG/libredwg/issues/43#issuecomment-440262663"},"message":"Oops, lotta problem with this file. I can repro it. It's a UNKNOWN_ENT problem, which is rare.","files":null},{"type":6,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542718766,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE1MzU2NDExMg=="},"target":"5175ecc91cd681829a616801329149ea1f432f9b434c1a09c2fd8181c6c6730b","message":"Oops, lotta problems with this file. I can repro it. It's a UNKNOWN_ENT problem, which is rare.\nI'll skip this handle on free, as all such handles are already freed with object_ref[]","files":null},{"type":4,"author":{"id":"b57a4f5420adf835b8b83469143e813bd4f12c78"},"timestamp":1542725613,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTk3NzU1ODU5Ng=="},"status":2}]}