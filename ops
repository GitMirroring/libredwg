{"version":1,"ops":[{"type":1,"author":{"id":"adf43da3a2a0f02dbfb5a8bdfc874e2af71e656d"},"timestamp":1562318748,"metadata":{"github-id":"MDU6SXNzdWU0NjQ1NDg5NjE=","github-url":"https://github.com/LibreDWG/libredwg/issues/118","origin":"github"},"title":"FIELDLIST handles (and maybe many more objects) not decoded correctly","message":"Hi,\n\nThe FIELDLIST object does not correctly decode it's field handles because there is an owerhandle, reactors and xdic handle read missing.\n\nThe following:\n  START_HANDLE_STREAM;\n  HANDLE_VECTOR (field_handles, num_fields, 0, 330); // 2 or 4, or 3.0.0\n\nneeds to change to (need to add ownerhandle to dwg_object_FIELDLIST \nstructure):\n  START_HANDLE_STREAM;\n  FIELD_HANDLE (ownerhandle, 4, 0);\n  REACTORS(4);\n  XDICOBJHANDLE(3);\n  HANDLE_VECTOR (field_handles, num_fields, 0, 330); // 2 or 4, or 3.0.0\n\nLooking at the dwg.spec it seems to me that EVERY object should have:\n\n  START_HANDLE_STREAM;\n  FIELD_HANDLE (ownerhandle, 4, 0);\n  REACTORS(4);\n  XDICOBJHANDLE(3);\n  // Further object handles start here\n\nbefore reading any other objects. Every object currently reads \u003cnum_reactors\u003e and \u003cxdic_missing_flag\u003e so that says to me that these handles may exist at the start of the handles stream. I have tested this with several objects:\n\nFIELD            - Already in issue #117 \nFIELDLIST\nMLEADERSTYLE - This needs the change I have suggested above\n\nA quick search through dwg.spec for \"START_HANDLE_STREAM\" showed many inconsistencies. \nFor example, BLOCK_CONTROL (indeed all '_CONTROL' objects) had a missing REACTORS(4). Several other objects (such as TABLECONTENT) would start reading private object handles immediately after the START_HANDLE_STREAM.\n\nI propose that a new macro is created called \"START_OBJECT_HANDLE_STREAM\" which simply expands to \n  START_HANDLE_STREAM;\n  FIELD_HANDLE (ownerhandle, 4, 0);\n  REACTORS(4);\n  XDICOBJHANDLE(3);\n\nand that all objects call this instead of just START_HANDLE_STREAM; \n\nThe only thing I am not sure of - does EVERY object have an ownerhandle.","files":null}]}