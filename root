{"version":1,"ops":[{"type":1,"author":{"id":"2bf6b52bc0dae630473aacf6f181bed209a5a6b2"},"timestamp":1571711064,"metadata":{"github-id":"MDU6SXNzdWU1MTAzOTQxNDg=","github-url":"https://github.com/LibreDWG/libredwg/issues/158","origin":"github"},"title":"Null pointer dereference in decode_R13_R2000","message":"The crash context in gdb\n\n```\npwndbg\u003e r\nStarting program: /home/lsl/workplace/libredwg-0.9.2376/examples/.libs/dwg2svg2 poc.dwg\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff793bd84 in decode_R13_R2000 (dat=dat@entry=0x7fffffffdee0, dwg=dwg@entry=0x6032a0 \u003cg_dwg\u003e) at decode.c:1109\n1109\t      if (strEQc ((const char *)klass-\u003edxfname, \"LAYOUT\"))\nLEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA\n───────────────────────────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────────────────────────────\n RAX  0x100\n RBX  0x60bc70 ◂— 0x100f4f4\n RCX  0x7\n RDX  0x100\n RDI  0x7ffff7b4cde6 ◂— pop    r9 /* 'LAYOUT' */\n RSI  0x0\n R8   0x5\n R9   0x7ffff74207b8 (main_arena+88) —▸ 0x60bcb0 ◂— 0x0\n R10  0x0\n R11  0x7ffff70e1200 (free+224) ◂— mov    rdx, rdi\n R12  0x7\n R13  0x60a1b8 ◂— 0xa00000000000000\n R14  0x7fffffffdee0 —▸ 0x605250 ◂— 0x1500323130314341 /* 'AC1012' */\n R15  0x6032a0 (g_dwg) ◂— 0xb0000000b /* '\\x0b' */\n RBP  0x1e002113\n RSP  0x7fffffffdd00 —▸ 0x7ffff706e0a8 ◂— in     eax, dx\n RIP  0x7ffff793bd84 (decode_R13_R2000+4228) ◂— repe cmpsb byte ptr [rsi], byte ptr [rdi]\n─────────────────────────────────────────────────────────────────────────────────[ DISASM ]─────────────────────────────────────────────────────────────────────────────────\n ► 0x7ffff793bd84 \u003cdecode_R13_R2000+4228\u003e    repe cmpsb byte ptr [rsi], byte ptr [rdi]\n   0x7ffff793bd86 \u003cdecode_R13_R2000+4230\u003e    jne    decode_R13_R2000+4242 \u003c0x7ffff793bd92\u003e\n    ↓\n   0x7ffff793bd92 \u003cdecode_R13_R2000+4242\u003e    movzx  eax, word ptr [r15 + 0xc40]\n   0x7ffff793bd9a \u003cdecode_R13_R2000+4250\u003e    lea    edx, [rax + 1]\n   0x7ffff793bd9d \u003cdecode_R13_R2000+4253\u003e    cmp    dx, 0x1f4\n   0x7ffff793bda2 \u003cdecode_R13_R2000+4258\u003e    mov    word ptr [r15 + 0xc40], dx\n   0x7ffff793bdaa \u003cdecode_R13_R2000+4266\u003e    ja     decode_R13_R2000+5434 \u003c0x7ffff793c23a\u003e\n    ↓\n   0x7ffff793c23a \u003cdecode_R13_R2000+5434\u003e    mov    eax, dword ptr [rip + 0x49b7bc] \u003c0x7ffff7dd79fc\u003e\n   0x7ffff793c240 \u003cdecode_R13_R2000+5440\u003e    test   eax, eax\n   0x7ffff793c242 \u003cdecode_R13_R2000+5442\u003e    je     decode_R13_R2000+5503 \u003c0x7ffff793c27f\u003e\n    ↓\n   0x7ffff793c27f \u003cdecode_R13_R2000+5503\u003e    mov    rax, qword ptr [r15 + 0x40]\n─────────────────────────────────────────────────────────────────────────────[ SOURCE (CODE) ]──────────────────────────────────────────────────────────────────────────────\nIn file: /home/lsl/workplace/libredwg-0.9.2376/src/decode.c\n   1104             klass-\u003enum_instances, klass-\u003edwg_version, klass-\u003emaint_version,\n   1105             klass-\u003eunknown_1, klass-\u003eunknown_2);\n   1106       }\n   1107 #endif\n   1108 \n ► 1109       if (strEQc ((const char *)klass-\u003edxfname, \"LAYOUT\"))\n   1110         dwg-\u003elayout_type = klass-\u003enumber;\n   1111 \n   1112       dwg-\u003enum_classes++;\n   1113       if (dwg-\u003enum_classes \u003e 500)\n   1114         {\n─────────────────────────────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────────────────────────────\n00:0000│ rsp  0x7fffffffdd00 —▸ 0x7ffff706e0a8 ◂— in     eax, dx\n01:0008│      0x7fffffffdd08 —▸ 0x7ffff7ff79e0 —▸ 0x7ffff705e000 ◂— jg     0x7ffff705e047\n02:0010│      0x7fffffffdd10 ◂— 0x5\n03:0018│      0x7fffffffdd18 ◂— 0x35 /* '5' */\n04:0020│      0x7fffffffdd20 —▸ 0x7fffffffdd80 —▸ 0x7ffff7b4cbae ◂— movsxd rax, dword ptr [r10 + 0x3a] /* 'AcDb:Header' */\n... ↓\n06:0030│      0x7fffffffdd30 ◂— 0x5bffffdd90\n07:0038│      0x7fffffffdd38 ◂— 0x0\n───────────────────────────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────────────────────────────\n ► f 0     7ffff793bd84 decode_R13_R2000+4228\n   f 1     7ffff79484cb dwg_decode+2315\n   f 2     7ffff77f14bb dwg_read_file+491\n   f 3           4014ee main+510\n   f 4           4014ee main+510\n   f 5     7ffff707ff45 __libc_start_main+245\n────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nProgram received signal SIGSEGV (fault address 0x0)\npwndbg\u003e p klass-\u003edxfname\n$1 = 0x0\npwndbg\u003e \n\n```\n\nThe poc\n\n```\nhttps://github.com/hac425xxx/fuzzdata/blob/master/null-ptr-poc.dwg\n```","files":null}]}