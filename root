{"version":1,"ops":[{"type":1,"author":{"id":"2bf6b52bc0dae630473aacf6f181bed209a5a6b2"},"timestamp":1571997479,"metadata":{"github-id":"MDU6SXNzdWU1MTI0MjEzMDc=","github-url":"https://github.com/LibreDWG/libredwg/issues/163","origin":"github"},"title":"Null pointer dereference in libredwg 0.9.2400","message":"crash context  in gdb\n\n```\npwndbg\u003e r\nStarting program: /home/xxx/workplace/libredwg-0.9.2400/examples/.libs/dwg2svg2 libredwg2400-null-ptr-dereference.dwg\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff776c904 in check_POLYLINE_handles (obj=obj@entry=0x60d6e0) at decode.c:4210\n4210                Dwg_Object_Ref *vertex = _obj-\u003evertex[0];\nLEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA\n───────────────────────────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────────────────────────────\n RAX  0x0\n RBX  0x6032a0 (g_dwg) ◂— 0x1200000012\n RCX  0xc60\n RDX  0x0\n RDI  0x60d6e0 ◂— 0x18c\n RSI  0x4\n R8   0x6\n R9   0x61649b ◂— 0x61004c0079004207\n R10  0x7fffffffd830 —▸ 0x7fffffffda70 —▸ 0x61649b ◂— 0x61004c0079004207\n R11  0x7ffff7916980 (dwg_add_POLYLINE_PFACE) ◂— push   rbp\n R12  0x612fd0 —▸ 0x612eb0 ◂— 0x1a\n R13  0x0\n R14  0x6032a0 (g_dwg) ◂— 0x1200000012\n R15  0x0\n RBP  0x60d6e0 ◂— 0x18c\n RSP  0x7fffffffdb10 ◂— 0x0\n RIP  0x7ffff776c904 (check_POLYLINE_handles+196) ◂— mov    r13, qword ptr [rax]\n─────────────────────────────────────────────────────────────────────────────────[ DISASM ]─────────────────────────────────────────────────────────────────────────────────\n ► 0x7ffff776c904 \u003ccheck_POLYLINE_handles+196\u003e    mov    r13, qword ptr [rax]\n   0x7ffff776c907 \u003ccheck_POLYLINE_handles+199\u003e    test   r13, r13\n   0x7ffff776c90a \u003ccheck_POLYLINE_handles+202\u003e    je     check_POLYLINE_handles+340 \u003c0x7ffff776c994\u003e\n    ↓\n   0x7ffff776c994 \u003ccheck_POLYLINE_handles+340\u003e    xor    ebx, ebx\n   0x7ffff776c996 \u003ccheck_POLYLINE_handles+342\u003e    test   r15, r15\n   0x7ffff776c999 \u003ccheck_POLYLINE_handles+345\u003e    je     check_POLYLINE_handles+354 \u003c0x7ffff776c9a2\u003e\n    ↓\n   0x7ffff776c9a2 \u003ccheck_POLYLINE_handles+354\u003e    cmp    dword ptr [rip + 0x66b053], 0 \u003c0x7ffff7dd79fc\u003e\n   0x7ffff776c9a9 \u003ccheck_POLYLINE_handles+361\u003e    je     check_POLYLINE_handles+545 \u003c0x7ffff776ca61\u003e\n    ↓\n   0x7ffff776ca61 \u003ccheck_POLYLINE_handles+545\u003e    cmp    dword ptr [r12 + 0xc], ebx\n   0x7ffff776ca66 \u003ccheck_POLYLINE_handles+550\u003e    ja     check_POLYLINE_handles+518 \u003c0x7ffff776ca46\u003e\n    ↓\n   0x7ffff776ca46 \u003ccheck_POLYLINE_handles+518\u003e    mov    rax, qword ptr [r12 + 0x20]\n─────────────────────────────────────────────────────────────────────────────[ SOURCE (CODE) ]──────────────────────────────────────────────────────────────────────────────\nIn file: /home/xxx/workplace/libredwg-0.9.2400/src/decode.c\n   4205         { // maybe a reactor pointing forwards or vertex\n   4206           LOG_WARN (\"Wrong POLYLINE.layer %lX\",\n   4207                     layer ? layer-\u003ehandleref.value : 0L);\n   4208           if (_obj-\u003enum_owned \u003e 0)\n   4209             {\n ► 4210               Dwg_Object_Ref *vertex = _obj-\u003evertex[0];\n   4211               if (vertex \u0026\u0026 !vertex-\u003eobj)\n   4212                 vertex-\u003eobj = dwg_ref_object_relative (dwg, vertex, obj);\n   4213               if (vertex \u0026\u0026 vertex-\u003eobj /* pointing backwards */\n   4214                   \u0026\u0026 vertex-\u003eobj-\u003efixedtype == DWG_TYPE_LAYER)\n   4215                 {\n─────────────────────────────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────────────────────────────\n00:0000│ rsp  0x7fffffffdb10 ◂— 0x0\n01:0008│      0x7fffffffdb18 —▸ 0x6032a0 (g_dwg) ◂— 0x1200000012\n02:0010│      0x7fffffffdb20 ◂— 0x0\n03:0018│      0x7fffffffdb28 —▸ 0x60d6e0 ◂— 0x18c\n04:0020│      0x7fffffffdb30 —▸ 0x7fffffffdd50 —▸ 0x61649b ◂— 0x61004c0079004207\n05:0028│      0x7fffffffdb38 ◂— 0x7400\n06:0030│      0x7fffffffdb40 —▸ 0x6131b0 ◂— 0xc3d000d00000dca\n07:0038│      0x7fffffffdb48 —▸ 0x7ffff79389ab (dwg_decode_add_object+3995) ◂— jmp    0x7ffff7937d60\n───────────────────────────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────────────────────────────\n ► f 0     7ffff776c904 check_POLYLINE_handles+196\n   f 1     7ffff79389ab dwg_decode_add_object+3995\n   f 2     7ffff79430d3 decode_R2004+1651\n   f 3     7ffff79430d3 decode_R2004+1651\n   f 4     7ffff79472f1 dwg_decode+2305\n   f 5     7ffff77ef34b dwg_read_file+491\n   f 6           4014ee main+510\n   f 7           4014ee main+510\n   f 8     7ffff707df45 __libc_start_main+245\n────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nProgram received signal SIGSEGV (fault address 0x0)\npwndbg\u003e p _obj-\u003evertex \n$1 = (BITCODE_H *) 0x0\npwndbg\u003e bt\n#0  0x00007ffff776c904 in check_POLYLINE_handles (obj=obj@entry=0x60d6e0) at decode.c:4210\n#1  0x00007ffff79389ab in dwg_decode_add_object (dwg=dwg@entry=0x6032a0 \u003cg_dwg\u003e, dat=dat@entry=0x7fffffffdd50, hdl_dat=hdl_dat@entry=0x7fffffffdd50, address=address@entry=13031) at decode.c:4663\n#2  0x00007ffff79430d3 in read_2004_section_handles (dwg=0x6032a0 \u003cg_dwg\u003e, dat=0x7fffffffdec0) at decode.c:2578\n#3  decode_R2004 (dat=dat@entry=0x7fffffffdec0, dwg=dwg@entry=0x6032a0 \u003cg_dwg\u003e) at decode.c:2848\n#4  0x00007ffff79472f1 in dwg_decode (dat=dat@entry=0x7fffffffdec0, dwg=dwg@entry=0x6032a0 \u003cg_dwg\u003e) at decode.c:245\n#5  0x00007ffff77ef34b in dwg_read_file (filename=0x7fffffffe3b3 \"libredwg2400-null-ptr-dereference.dwg\", dwg=dwg@entry=0x6032a0 \u003cg_dwg\u003e) at dwg.c:206\n#6  0x00000000004014ee in test_SVG (filename=\u003coptimized out\u003e) at dwg2svg2.c:119\n#7  main (argc=argc@entry=2, argv=argv@entry=0x7fffffffe0f8) at dwg2svg2.c:504\n#8  0x00007ffff707df45 in __libc_start_main (main=0x4012f0 \u003cmain\u003e, argc=2, argv=0x7fffffffe0f8, init=\u003coptimized out\u003e, fini=\u003coptimized out\u003e, rtld_fini=\u003coptimized out\u003e, stack_end=0x7fffffffe0e8) at libc-start.c:287\n#9  0x0000000000401770 in _start ()\npwndbg\u003e \n\n```\n\npoc\n```\nhttps://github.com/hac425xxx/fuzzdata/blob/master/libredwg2400-null-ptr-dereference.dwg\n```","files":null}]}