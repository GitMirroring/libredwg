{"version":1,"ops":[{"type":1,"author":{"id":"92d786e78a13918866d6b1068d3f0983fe3b982d"},"timestamp":1577159072,"metadata":{"github-id":"MDU6SXNzdWU1NDE5Nzc3NjU=","github-url":"https://github.com/LibreDWG/libredwg/issues/176","origin":"github"},"title":"Several bugs found by fuzzing","message":"Hi,\nAfter fuzzing libredwg, I found the following bugs on the latest commit on master.\nCommand: dwg2dxf $PoC\n**1.Crafted input will lead to Memory allocation failed in dwg_decode_SPLINE_private (src/dwg.spec:1639)**\nPoC: https://github.com/linhlhq/research/blob/master/PoCs/libreDWG/id:000000%2Csig:06%2Csrc:000000%2Cop:flip1%2Cpos:36317\nASAN says:\n`==6231==ERROR: AddressSanitizer failed to allocate 0xd54f86000 (57260138496) bytes of LargeMmapAllocator (error code: 12)\n==6231==Process memory map follows:\n\t0x00007fff7000-0x00008fff7000\n\t0x00008fff7000-0x02008fff7000\n\t0x02008fff7000-0x10007fff8000\n\t0x55f7ba14f000-0x55f7bb643000\t/home/user/linhlhq/libredwg/obj-afl/programs/dwg2dxf\n\t0x55f7bb843000-0x55f7bb85b000\t/home/user/linhlhq/libredwg/obj-afl/programs/dwg2dxf\n\t0x55f7bb85b000-0x55f7bb93f000\t/home/user/linhlhq/libredwg/obj-afl/programs/dwg2dxf\n\t0x55f7bb93f000-0x55f7bb943000\n\t0x600000000000-0x602000000000\n\t0x602000000000-0x602000010000\n\t0x602000010000-0x602e00000000\n\t0x602e00000000-0x602e00010000\n\t0x602e00010000-0x603000000000\n\t0x603000000000-0x603000020000\n\t0x603000020000-0x603e00000000\n\t0x603e00000000-0x603e00010000\n\t0x603e00010000-0x604000000000\n\t0x604000000000-0x604000010000\n\t0x604000010000-0x604e00000000\n\t0x604e00000000-0x604e00010000\n\t0x604e00010000-0x606000000000\n\t0x606000000000-0x606000010000\n\t0x606000010000-0x606e00000000\n\t0x606e00000000-0x606e00010000\n\t0x606e00010000-0x607000000000\n\t0x607000000000-0x607000010000\n\t0x607000010000-0x607e00000000\n\t0x607e00000000-0x607e00010000\n\t0x607e00010000-0x608000000000\n\t0x608000000000-0x608000010000\n\t0x608000010000-0x608e00000000\n\t0x608e00000000-0x608e00010000\n\t0x608e00010000-0x60b000000000\n\t0x60b000000000-0x60b000010000\n\t0x60b000010000-0x60be00000000\n\t0x60be00000000-0x60be00010000\n\t0x60be00010000-0x60c000000000\n\t0x60c000000000-0x60c000010000\n\t0x60c000010000-0x60ce00000000\n\t0x60ce00000000-0x60ce00010000\n\t0x60ce00010000-0x60d000000000\n\t0x60d000000000-0x60d000010000\n\t0x60d000010000-0x60de00000000\n\t0x60de00000000-0x60de00010000\n\t0x60de00010000-0x60e000000000\n\t0x60e000000000-0x60e000010000\n\t0x60e000010000-0x60ee00000000\n\t0x60ee00000000-0x60ee00010000\n\t0x60ee00010000-0x60f000000000\n\t0x60f000000000-0x60f000010000\n\t0x60f000010000-0x60fe00000000\n\t0x60fe00000000-0x60fe00010000\n\t0x60fe00010000-0x610000000000\n\t0x610000000000-0x610000010000\n\t0x610000010000-0x610e00000000\n\t0x610e00000000-0x610e00010000\n\t0x610e00010000-0x611000000000\n\t0x611000000000-0x611000010000\n\t0x611000010000-0x611e00000000\n\t0x611e00000000-0x611e00010000\n\t0x611e00010000-0x612000000000\n\t0x612000000000-0x612000020000\n\t0x612000020000-0x612e00000000\n\t0x612e00000000-0x612e00010000\n\t0x612e00010000-0x613000000000\n\t0x613000000000-0x613000010000\n\t0x613000010000-0x613e00000000\n\t0x613e00000000-0x613e00010000\n\t0x613e00010000-0x614000000000\n\t0x614000000000-0x614000010000\n\t0x614000010000-0x614e00000000\n\t0x614e00000000-0x614e00010000\n\t0x614e00010000-0x615000000000\n\t0x615000000000-0x615000010000\n\t0x615000010000-0x615e00000000\n\t0x615e00000000-0x615e00010000\n\t0x615e00010000-0x616000000000\n\t0x616000000000-0x616000010000\n\t0x616000010000-0x616e00000000\n\t0x616e00000000-0x616e00010000\n\t0x616e00010000-0x617000000000\n\t0x617000000000-0x617000010000\n\t0x617000010000-0x617e00000000\n\t0x617e00000000-0x617e00010000\n\t0x617e00010000-0x618000000000\n\t0x618000000000-0x618000010000\n\t0x618000010000-0x618e00000000\n\t0x618e00000000-0x618e00010000\n\t0x618e00010000-0x619000000000\n\t0x619000000000-0x619000010000\n\t0x619000010000-0x619e00000000\n\t0x619e00000000-0x619e00010000\n\t0x619e00010000-0x61a000000000\n\t0x61a000000000-0x61a000010000\n\t0x61a000010000-0x61ae00000000\n\t0x61ae00000000-0x61ae00010000\n\t0x61ae00010000-0x61b000000000\n\t0x61b000000000-0x61b000010000\n\t0x61b000010000-0x61be00000000\n\t0x61be00000000-0x61be00010000\n\t0x61be00010000-0x61c000000000\n\t0x61c000000000-0x61c000010000\n\t0x61c000010000-0x61ce00000000\n\t0x61ce00000000-0x61ce00010000\n\t0x61ce00010000-0x61d000000000\n\t0x61d000000000-0x61d000010000\n\t0x61d000010000-0x61de00000000\n\t0x61de00000000-0x61de00010000\n\t0x61de00010000-0x61f000000000\n\t0x61f000000000-0x61f000010000\n\t0x61f000010000-0x61fe00000000\n\t0x61fe00000000-0x61fe00010000\n\t0x61fe00010000-0x620000000000\n\t0x620000000000-0x620000010000\n\t0x620000010000-0x620e00000000\n\t0x620e00000000-0x620e00010000\n\t0x620e00010000-0x621000000000\n\t0x621000000000-0x621000010000\n\t0x621000010000-0x621e00000000\n\t0x621e00000000-0x621e00010000\n\t0x621e00010000-0x622000000000\n\t0x622000000000-0x622000010000\n\t0x622000010000-0x622e00000000\n\t0x622e00000000-0x622e00010000\n\t0x622e00010000-0x623000000000\n\t0x623000000000-0x623000010000\n\t0x623000010000-0x623e00000000\n\t0x623e00000000-0x623e00010000\n\t0x623e00010000-0x624000000000\n\t0x624000000000-0x624000010000\n\t0x624000010000-0x624e00000000\n\t0x624e00000000-0x624e00010000\n\t0x624e00010000-0x629000000000\n\t0x629000000000-0x629000010000\n\t0x629000010000-0x629e00000000\n\t0x629e00000000-0x629e00010000\n\t0x629e00010000-0x62c000000000\n\t0x62c000000000-0x62c000010000\n\t0x62c000010000-0x62ce00000000\n\t0x62ce00000000-0x62ce00010000\n\t0x62ce00010000-0x62d000000000\n\t0x62d000000000-0x62d000010000\n\t0x62d000010000-0x62de00000000\n\t0x62de00000000-0x62de00010000\n\t0x62de00010000-0x630000000000\n\t0x630000000000-0x630000010000\n\t0x630000010000-0x630e00000000\n\t0x630e00000000-0x630e00010000\n\t0x630e00010000-0x640000000000\n\t0x640000000000-0x640000003000\n\t0x7fd77dd00000-0x7fd77de00000\n\t0x7fd77df00000-0x7fd77e000000\n\t0x7fd77e100000-0x7fd77e200000\n\t0x7fd77e300000-0x7fd77e400000\n\t0x7fd77e42b000-0x7fd78077d000\n\t0x7fd78077d000-0x7fd780794000\t/lib/x86_64-linux-gnu/libgcc_s.so.1\n\t0x7fd780794000-0x7fd780993000\t/lib/x86_64-linux-gnu/libgcc_s.so.1\n\t0x7fd780993000-0x7fd780994000\t/lib/x86_64-linux-gnu/libgcc_s.so.1\n\t0x7fd780994000-0x7fd780995000\t/lib/x86_64-linux-gnu/libgcc_s.so.1\n\t0x7fd780995000-0x7fd7809af000\t/lib/x86_64-linux-gnu/libpthread-2.27.so\n\t0x7fd7809af000-0x7fd780bae000\t/lib/x86_64-linux-gnu/libpthread-2.27.so\n\t0x7fd780bae000-0x7fd780baf000\t/lib/x86_64-linux-gnu/libpthread-2.27.so\n\t0x7fd780baf000-0x7fd780bb0000\t/lib/x86_64-linux-gnu/libpthread-2.27.so\n\t0x7fd780bb0000-0x7fd780bb4000\n\t0x7fd780bb4000-0x7fd780bbb000\t/lib/x86_64-linux-gnu/librt-2.27.so\n\t0x7fd780bbb000-0x7fd780dba000\t/lib/x86_64-linux-gnu/librt-2.27.so\n\t0x7fd780dba000-0x7fd780dbb000\t/lib/x86_64-linux-gnu/librt-2.27.so\n\t0x7fd780dbb000-0x7fd780dbc000\t/lib/x86_64-linux-gnu/librt-2.27.so\n\t0x7fd780dbc000-0x7fd780dbf000\t/lib/x86_64-linux-gnu/libdl-2.27.so\n\t0x7fd780dbf000-0x7fd780fbe000\t/lib/x86_64-linux-gnu/libdl-2.27.so\n\t0x7fd780fbe000-0x7fd780fbf000\t/lib/x86_64-linux-gnu/libdl-2.27.so\n\t0x7fd780fbf000-0x7fd780fc0000\t/lib/x86_64-linux-gnu/libdl-2.27.so\n\t0x7fd780fc0000-0x7fd7811a7000\t/lib/x86_64-linux-gnu/libc-2.27.so\n\t0x7fd7811a7000-0x7fd7813a7000\t/lib/x86_64-linux-gnu/libc-2.27.so\n\t0x7fd7813a7000-0x7fd7813ab000\t/lib/x86_64-linux-gnu/libc-2.27.so\n\t0x7fd7813ab000-0x7fd7813ad000\t/lib/x86_64-linux-gnu/libc-2.27.so\n\t0x7fd7813ad000-0x7fd7813b1000\n\t0x7fd7813b1000-0x7fd78154e000\t/lib/x86_64-linux-gnu/libm-2.27.so\n\t0x7fd78154e000-0x7fd78174d000\t/lib/x86_64-linux-gnu/libm-2.27.so\n\t0x7fd78174d000-0x7fd78174e000\t/lib/x86_64-linux-gnu/libm-2.27.so\n\t0x7fd78174e000-0x7fd78174f000\t/lib/x86_64-linux-gnu/libm-2.27.so\n\t0x7fd78174f000-0x7fd78189f000\t/usr/lib/x86_64-linux-gnu/libasan.so.4.0.0\n\t0x7fd78189f000-0x7fd781a9f000\t/usr/lib/x86_64-linux-gnu/libasan.so.4.0.0\n\t0x7fd781a9f000-0x7fd781aa2000\t/usr/lib/x86_64-linux-gnu/libasan.so.4.0.0\n\t0x7fd781aa2000-0x7fd781aa5000\t/usr/lib/x86_64-linux-gnu/libasan.so.4.0.0\n\t0x7fd781aa5000-0x7fd78270a000\n\t0x7fd78270a000-0x7fd782731000\t/lib/x86_64-linux-gnu/ld-2.27.so\n\t0x7fd78279d000-0x7fd782927000\n\t0x7fd782927000-0x7fd782931000\n\t0x7fd782931000-0x7fd782932000\t/lib/x86_64-linux-gnu/ld-2.27.so\n\t0x7fd782932000-0x7fd782933000\t/lib/x86_64-linux-gnu/ld-2.27.so\n\t0x7fd782933000-0x7fd782934000\n\t0x7fffa34fe000-0x7fffa351f000\t[stack]\n\t0x7fffa35bc000-0x7fffa35bf000\t[vvar]\n\t0x7fffa35bf000-0x7fffa35c1000\t[vdso]\n\t0xffffffffff600000-0xffffffffff601000\t[vsyscall]\n==6231==End of process memory map.\n==6231==AddressSanitizer CHECK failed: ../../../../src/libsanitizer/sanitizer_common/sanitizer_common.cc:118 \"((0 \u0026\u0026 \"unable to mmap\")) != (0)\" (0x0, 0x0)\n    #0 0x7fd781838c02  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xe9c02)\n    #1 0x7fd781857595 in __sanitizer::CheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x108595)\n    #2 0x7fd781842492  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xf3492)\n    #3 0x7fd78184e8a5  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xff8a5)\n    #4 0x7fd78177b8f1  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x2c8f1)\n    #5 0x7fd78177604b  (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x2704b)\n    #6 0x7fd78182dd00 in __interceptor_calloc (/usr/lib/x86_64-linux-gnu/libasan.so.4+0xded00)\n    #7 0x55f7ba79bec8 in dwg_decode_SPLINE_private ../../src/dwg.spec:1639\n    #8 0x55f7ba7a4e19 in dwg_decode_SPLINE ../../src/dwg.spec:1585\n    #9 0x55f7bab4b89b in dwg_decode_add_object ../../src/decode.c:4738\n    #10 0x55f7bab5ef28 in decode_R13_R2000 ../../src/decode.c:1216\n    #11 0x55f7bab9161a in dwg_decode ../../src/decode.c:239\n    #12 0x55f7ba533f7a in dwg_read_file ../../src/dwg.c:206\n    #13 0x55f7ba53232d in main ../../programs/dwg2dxf.c:255\n    #14 0x7fd780fe1b96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)\n    #15 0x55f7ba5332e9 in _start (/home/user/linhlhq/libredwg/obj-afl/programs/dwg2dxf+0x3e42e9)\n`\nThanks,\nLinhlhq from Infiniti Team, VinCSS (a member of Vingroup) # #","files":null}]}